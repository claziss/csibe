<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>CSiBE - Compiler monitor</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/custom.css" rel="stylesheet">
    <link href="css/classic-min.css" rel="stylesheet">
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  </head>
  <body>

    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <a class="navbar-brand" href="compiler-monitor.html">CSiBE - Compiler monitor</a>
        </div>
      </div>
    </nav>

    <div class="container" style="margin-top: 65px;">
        <select id="arch-cm">
            <option value="all">All platforms</option>
            <option value="arm">ARM</option>
            <option value="x86">x86</option>
        </select>
        <select id="compiler-flag-cm">
            <option value="all">All flags</option>
        </select>
        <select id="project-name-cm">
            <option value="all">Summarize projects</option>
        </select>

        <div id="chart_div_cm" style="width: 100%; height: 500px;"></div>

        <div id="date-slider"></div>

        <hr>

        <footer>
            <p>&copy; University of Szeged 2016</p>
        </footer>

    </div>

    <!-- jQuery -->
    <script src="js/jquery-1.11.3.min.js"></script>

    <!-- jQuery UI -->
    <script src="js/jquery-ui.min.js"></script>

    <!-- jQRangeSlider -->
    <script src="js/jQDateRangeSlider-min.js"></script>

    <!-- jQuery MouseWheel -->
    <script src="js/jquery.mousewheel.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="js/bootstrap.min.js"></script>

    <!-- Custom Javascript -->
    <script src="js/custom.js"></script>

    <!-- CSiBe results charts -->
    <script type="text/javascript" src="js/chart.js"></script>
    <script type="text/javascript">

        var arch_cm = document.getElementById('arch-cm');
        var date_cm = document.getElementById('date-cm');
        var flag_cm = document.getElementById('compiler-flag-cm');
        var project_cm = document.getElementById('project-name-cm');

        var platforms = [];
        platforms = platforms.concat(arm_targets);
        platforms = platforms.concat(x86_targets);
        for (var i = 0; i < platforms.length; i++) {
            arch_cm.options[arch_cm.options.length]
                                        = new Option(findPlatformAlias(platforms[i]), platforms[i]);
        }

        for (var i = 0; i < project_names.length; i++) {
            project_cm.options[project_cm.options.length]
                                        = new Option(project_names[i], project_names[i]);
        }

        for (var i = 0; i < compiler_flags.length; i++) {
            flag_cm.options[flag_cm.options.length]
                                        = new Option(compiler_flags[i], compiler_flags[i]);
        }

        var today = new Date();
        var sliderDefaultMinValue = new Date();
        sliderDefaultMinValue.setDate(today.getDate() - 10);

        $("#date-slider").dateRangeSlider({
            bounds: {
                min: first_result_date,
                max: today
            },
            defaultValues: {
                min: sliderDefaultMinValue,
                max: today
            },
            wheelMode: "zoom"
        });

        date_slider_ui = $("#date-slider");

        google.charts.load('current', { packages: ['corechart', 'line'], callback: visualizationApiReady });
        function visualizationApiReady() {
            chart_div = document.querySelector('#chart_div_cm');

            arch_cm.selectedIndex = 0;
            chart_filter.arch = arch_cm.options[arch_cm.selectedIndex].value;

            flag_cm.selectedIndex = 0;
            chart_filter.flag = flag_cm.options[flag_cm.selectedIndex].value;

            chart_filter.from_date =  $("#date-slider").dateRangeSlider("min");
            chart_filter.from_date = new Date(chart_filter.from_date.setHours(1, 0, 0, 0));
            chart_filter.to_date = $("#date-slider").dateRangeSlider("max");
            chart_filter.to_date = new Date(chart_filter.to_date.setHours(1, 0, 0, 0));

            project_cm.selectedIndex = 0;
            chart_filter.project = project_cm.options[project_cm.selectedIndex].value;

            showPlatforms();
        };

        $('#arch-cm').on('change', function(e) {
            chart_filter.arch = arch_cm.options[arch_cm.selectedIndex].value;
            showPlatforms();
        });

        $("#date-slider").bind("valuesChanged", function(e, data){
            chart_filter.from_date = data.values.min;
            chart_filter.from_date = new Date(chart_filter.from_date.setHours(1, 0, 0, 0));
            chart_filter.to_date = data.values.max;
            chart_filter.to_date = new Date(chart_filter.to_date.setHours(1, 0, 0, 0));
            showPlatforms();
        });

        $('#compiler-flag-cm').on('change', function(e) {
            chart_filter.flag = flag_cm.options[flag_cm.selectedIndex].value;
            showPlatforms();
        });

        $('#project-name-cm').on('change', function(e) {
            chart_filter.project = project_cm.options[project_cm.selectedIndex].value;
            showPlatforms();
        });
    </script>

  </body>
</html>
